# Story 2.3: AI-Powered Content Generation from English - DEVELOPER HANDOFF

## ðŸŽ¯ Story Goal
**As a** content author  
**I want** to describe my reference text in plain English and have AI generate the static/dynamic sections  
**So that** I can quickly create complex TPN advisories without deep JavaScript knowledge

## ðŸ“‹ Pre-Implementation Checklist
- [ ] Review existing Gemini integration in `api/generate-tests.js`
- [ ] Understand TPN context in `src/lib/tpnLegacy.js` and `src/lib/tpnReferenceRanges.js`
- [ ] Check section management in `src/App.svelte`
- [ ] Review TestGeneratorModal for modal patterns

## ðŸ”§ Implementation Steps

### Step 1: Create Content Generation API Endpoint
Create `api/generate-content.js`:
```javascript
import { GoogleGenerativeAI } from "@google/generative-ai";
import { tpnReferenceRanges } from "../src/lib/tpnReferenceRanges.js";

export default async function handler(req, res) {
  if (req.method \!== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  const { prompt, context, existingSections } = req.body;
  const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

  const systemPrompt = `
    You are an expert TPN (Total Parenteral Nutrition) advisor content creator.
    
    Context:
    - Available TPN ingredients: ${JSON.stringify(context.ingredients || [])}
    - Reference ranges: ${JSON.stringify(tpnReferenceRanges)}
    - Population types: Neonatal, Pediatric, Adolescent, Adult
    
    User can access values via: me.getValue("IngredientName")
    
    Instructions:
    1. Generate appropriate HTML for static content
    2. Generate JavaScript for dynamic calculations
    3. Use Bootstrap alert classes for warnings/info
    4. Return JSON with { type: "static"|"dynamic", content: string, description: string }
    
    Example static output:
    <div class="alert alert-info">
      <h4>Information</h4>
      <p>Your message here</p>
    </div>
    
    Example dynamic output:
    const value = me.getValue("Glucose");
    if (value > 30) {
      return "<div class=\"alert alert-warning\">High glucose\!</div>";
    }
    return "<div class=\"alert alert-success\">Glucose normal</div>";
  `;

  try {
    const model = genAI.getGenerativeModel({ model: "gemini-pro" });
    const fullPrompt = `${systemPrompt}\n\nUser request: ${prompt}`;
    
    const result = await model.generateContent(fullPrompt);
    const response = JSON.parse(result.response.text());
    
    res.status(200).json(response);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
}
```
