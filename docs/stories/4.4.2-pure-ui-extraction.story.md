# Story 4.4.2: Pure UI Component Extraction

## Status
Ready for Development

## Story
**As a** developer,
**I want** to extract pure UI components (modals) from App.svelte,
**So that** we reduce App.svelte's size while maintaining exact functionality and making the code more maintainable.

## Acceptance Criteria
1. TestCaseModal extracted to separate component file
2. IngredientExportModal extracted to separate component file  
3. DuplicateReportModal extracted to separate component file (if exists)
4. All props and events remain identical (no API changes)
5. App.svelte reduced by 400-500 lines
6. Visual appearance and behavior unchanged
7. All modal functionality works exactly as before

## Tasks / Subtasks

### TDD Workflow (MANDATORY - Follow this exact order)

**Phase 1: Write Tests First**
- [ ] Write visual regression tests using Playwright MCP
  - [ ] Capture screenshots of TestCaseModal in current state
  - [ ] Capture screenshots of IngredientExportModal
  - [ ] Capture screenshots of other modals
  - [ ] Test modal open/close behavior
  - [ ] Test form submissions within modals
  - [ ] Test cancel/escape behavior
- [ ] Write component tests for modal functionality
  - [ ] Test prop passing
  - [ ] Test event emission
  - [ ] Test internal state management
- [ ] ✅ All tests written and passing with current implementation

**Phase 2: Make Tests Pass (Minimal Implementation)**
- [ ] Identify Modal Components in App.svelte (AC: 1, 2, 3)
  - [ ] Search for TestCaseModal implementation
  - [ ] Search for IngredientExportModal implementation
  - [ ] Search for any other modal components
  - [ ] Document line numbers and prop interfaces
  - [ ] Map all event handlers and bindings
  - [ ] ✅ All modals identified with clear boundaries

- [ ] Extract TestCaseModal Component (AC: 1, 4)
  - [ ] Create `src/lib/components/TestCaseModal.svelte`
  - [ ] Copy modal HTML/CSS/JS exactly as-is
  - [ ] Define props interface matching current usage
  - [ ] Preserve all event dispatchers
  - [ ] Import and use in App.svelte
  - [ ] ✅ TestCaseModal working identically

- [ ] Extract IngredientExportModal Component (AC: 2, 4)
  - [ ] Create `src/lib/components/IngredientExportModal.svelte`
  - [ ] Copy modal implementation exactly
  - [ ] Maintain all props and bindings
  - [ ] Preserve export logic as-is
  - [ ] Import and use in App.svelte
  - [ ] ✅ IngredientExportModal working identically

- [ ] Extract Additional Modal Components (AC: 3, 4)
  - [ ] Identify any other pure modal components
  - [ ] Extract each to separate file
  - [ ] Maintain exact interfaces
  - [ ] Test each extraction individually
  - [ ] ✅ All modals extracted successfully

- [ ] Visual Regression Testing (AC: 6, 7)
  - [ ] Take new screenshots of all modals
  - [ ] Compare with baseline screenshots
  - [ ] Verify pixel-perfect match
  - [ ] Test all interactions
  - [ ] ✅ Visual regression tests pass

**Phase 3: Refactor for Maintainability**
- [ ] Clean up extracted components
  - [ ] Add proper TypeScript types
  - [ ] Format with consistent style
  - [ ] Add minimal comments for clarity
  - [ ] Ensure Svelte 5 best practices
- [ ] Verify App.svelte reduction (AC: 5)
  - [ ] Count lines before extraction
  - [ ] Count lines after extraction
  - [ ] Confirm 400-500 line reduction
  - [ ] Document the reduction achieved
- [ ] ✅ Components are clean and well-organized

### Manual Testing Checklist (AC: 7)
- [ ] Test TestCaseModal
  - [ ] Opens when triggered
  - [ ] Displays correct content
  - [ ] Form inputs work
  - [ ] Save button works
  - [ ] Cancel button works
  - [ ] Escape key closes modal
- [ ] Test IngredientExportModal
  - [ ] Opens correctly
  - [ ] Shows export preview
  - [ ] Copy button works
  - [ ] Download works
  - [ ] Close button works
- [ ] Test any other extracted modals
- [ ] ✅ All modals function identically to before

## Dev Notes

### Modal Identification Strategy
[Source: Epic 4.4 Conservative Refactoring]
Focus on "pure" UI components - those with:
- No business logic (just display and user input)
- Clear boundaries (self-contained modal markup)
- Simple prop interfaces
- Event-based communication with parent

### Current App.svelte Size
[Source: architecture-shards/6-component-specifications.md#Current Component Inventory]
- App.svelte: 3,556 lines (needs reduction)
- Target after this story: ~3,100 lines
- Ultimate target: <500 lines (future stories)

### Component Extraction Pattern
[Source: architecture-shards/6-component-specifications.md#Component Communication Pattern]
```svelte
<!-- In App.svelte (parent) -->
<TestCaseModal
  bind:isOpen={showTestModal}
  testCases={currentTestCases}
  on:save={handleTestSave}
  on:cancel={() => showTestModal = false}
/>

<!-- In TestCaseModal.svelte (child) -->
<script>
  import { createEventDispatcher } from 'svelte';
  
  export let isOpen = false;
  export let testCases = [];
  
  const dispatch = createEventDispatcher();
  
  function handleSave() {
    dispatch('save', { testCases });
  }
</script>
```

### File Locations
[Source: architecture-shards/4-architecture-patterns.md#Component Architecture]
New modal components should be placed in:
- `src/lib/components/TestCaseModal.svelte`
- `src/lib/components/IngredientExportModal.svelte`
- `src/lib/components/[ModalName].svelte`

### Svelte 5 Patterns
[Source: architecture-shards/3-technology-stack.md#Frontend Core]
Use Svelte 5 runes where appropriate:
- `$state` for reactive state
- `$derived` for computed values
- `$props()` for component props

### Visual Testing with Playwright MCP
[Source: architecture-shards/6-component-specifications.md#Browser Automation Available]
Use Playwright MCP for visual regression:
```javascript
// Take baseline screenshot
mcp__playwright__browser_take_screenshot({
  filename: 'test-case-modal-baseline.png'
})

// After extraction, take new screenshot
mcp__playwright__browser_take_screenshot({
  filename: 'test-case-modal-after.png'
})

// Compare visually for regressions
```

### Extraction Rules
[Source: Epic 4.4 - Important Constraints]
- NO changing component boundaries that work
- NO altering data flow patterns
- Keep ALL props and events identical
- Make one extraction at a time
- Test after each extraction
- Commit immediately when working

### Risk Mitigation
- Extract one modal at a time
- Test thoroughly after each extraction
- Keep the original code commented until verified
- Visual regression testing is critical
- Rollback if any functionality breaks

## Testing
- Visual regression tests with screenshots
- Component unit tests
- Manual testing of all modal features
- Integration testing with App.svelte

## Definition of Done
- [ ] All identified modals extracted to separate files
- [ ] App.svelte reduced by 400-500 lines
- [ ] All modals work exactly as before
- [ ] Visual regression tests pass
- [ ] No changes to modal behavior or appearance
- [ ] Clean component files with proper structure
- [ ] Committed to git with clear message

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-01 | 1.0 | Initial story creation from Epic 4.4 | Scrum Master Bob |

## Dev Agent Record
### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

## QA Results
_To be filled by QA agent_