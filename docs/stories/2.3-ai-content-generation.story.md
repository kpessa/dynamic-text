# Story 2.3: AI-Powered Content Generation from English

## Story
**As a** content author  
**I want** to describe my reference text in plain English and have AI generate the static/dynamic sections  
**So that** I can quickly create complex TPN advisories without deep JavaScript knowledge

## Priority
**Medium** - High value feature, leverages existing AI infrastructure

## Acceptance Criteria
1. **Natural Language Input**: Text area for English description of desired output
2. **Context Awareness**: AI understands TPN context and available ingredients
3. **Section Generation**: Creates appropriate static HTML and dynamic JS sections
4. **Preview Before Apply**: Show generated content before insertion
5. **Iterative Refinement**: Allow follow-up modifications via conversation
6. **Template Learning**: AI learns from existing sections in the project

## Technical Requirements
- Extend existing Gemini API endpoint
- Rich prompt engineering with TPN context
- Modal interface for AI interaction
- Integration with section management system

## Implementation Notes
- Build on `api/generate-tests.js` patterns
- Include TPN reference ranges in system prompt
- Provide ingredient list and sample usage
- Support both new section creation and existing section enhancement

## Test Scenarios
1. Generate simple static HTML from description
2. Generate dynamic JavaScript for TPN calculation
3. Generate mixed static/dynamic content
4. Refine generated content with follow-up
5. Handle ambiguous requests appropriately
6. Generate content using specific ingredients

## Dependencies
- Gemini API (existing integration)
- TPN reference data (`tpnReferenceRanges.js`)
- Ingredient system context
- Section creation/editing infrastructure

## MVP Scope
- Single prompt → single section generation
- Basic TPN context awareness
- Simple preview and apply workflow

## Future Enhancements
- Multi-turn conversation for refinement
- Learn from user's existing sections
- Generate entire configurations from requirements
- Suggest improvements to existing sections
- Export/import prompt templates

## Story Points
**5** - Complex prompt engineering, UI/UX considerations

## Sprint Ready
✅ Yes - Builds on proven AI integration pattern

## Related Stories
- Shares AI infrastructure with Story 2.2 (Alternative Implementations)
- Enhances Story 1.5 (TPN Configuration Management) workflow

## Example Use Cases

### Example 1: Simple Static Content
**User Input**: "Create a warning about high glucose levels above 30"
**Generated Output**:
```html
<div class="alert alert-warning">
  <strong>⚠️ High Glucose Alert</strong>
  <p>Glucose concentration exceeds 30 g/kg/day. Consider reducing to avoid hyperglycemia.</p>
</div>
```

### Example 2: Dynamic TPN Calculation
**User Input**: "Show calcium to phosphorus ratio and warn if outside 1.3-2.0 range"
**Generated Output**:
```javascript
const calcium = me.getValue('Calcium');
const phosphorus = me.getValue('Phosphorus');
const ratio = calcium / phosphorus;

if (ratio < 1.3 || ratio > 2.0) {
  return `<div class="alert alert-warning">
    Ca:P ratio is ${ratio.toFixed(2)} (target: 1.3-2.0)
  </div>`;
}
return `<div class="alert alert-success">
  Ca:P ratio is ${ratio.toFixed(2)} ✓
</div>`;
```

### Example 3: Complex Advisory
**User Input**: "Create an advisor that checks if amino acid intake is appropriate for the patient's weight and age, considering premature neonates need 3-4 g/kg/day"
**Generated Output**: [Complex multi-condition dynamic section with age/weight calculations]